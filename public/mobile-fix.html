<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üîß Corre√ß√£o Mobile - Leirisonda</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: white;
      }
      .container {
        max-width: 400px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }
      h1 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 24px;
        font-weight: 600;
      }
      .problem {
        background: rgba(244, 67, 54, 0.2);
        border: 1px solid rgba(244, 67, 54, 0.5);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        font-size: 14px;
      }
      .solution {
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid rgba(76, 175, 80, 0.5);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        font-size: 14px;
      }
      .btn {
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: block;
        text-align: center;
      }
      .btn-primary {
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: white;
      }
      .btn-warning {
        background: linear-gradient(135deg, #ff9800, #f57c00);
        color: white;
      }
      .btn-danger {
        background: linear-gradient(135deg, #f44336, #d32f2f);
        color: white;
      }
      .btn:active {
        transform: scale(0.98);
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        font-size: 14px;
        text-align: center;
      }
      .status-success {
        background: rgba(76, 175, 80, 0.3);
        border: 1px solid rgba(76, 175, 80, 0.6);
      }
      .status-error {
        background: rgba(244, 67, 54, 0.3);
        border: 1px solid rgba(244, 67, 54, 0.6);
      }
      .status-info {
        background: rgba(33, 150, 243, 0.3);
        border: 1px solid rgba(33, 150, 243, 0.6);
      }
      .countdown {
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        margin: 15px 0;
      }
      input {
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 16px;
      }
      input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Corre√ß√£o Mobile</h1>

      <div class="problem">
        <strong>‚ùå Problemas Detectados:</strong><br />
        ‚Ä¢ TOO_MANY_ATTEMPTS_TRY_LATER<br />
        ‚Ä¢ WEAK_PASSWORD (m√≠n. 6 caracteres)<br />
        ‚Ä¢ Conta bloqueada temporariamente
      </div>

      <div class="solution">
        <strong>‚úÖ Solu√ß√µes Dispon√≠veis:</strong><br />
        ‚Ä¢ Acesso direto sem Firebase<br />
        ‚Ä¢ Reset completo do sistema<br />
        ‚Ä¢ Cria√ß√£o de nova senha
      </div>

      <!-- Bot√µes principais -->
      <button class="btn btn-primary" onclick="loginDirecto()">
        üöÄ ENTRAR AGORA (Direto)
      </button>

      <button class="btn btn-warning" onclick="resetarSistema()">
        üîÑ Resetar Sistema
      </button>

      <button class="btn btn-danger" onclick="mostrarCriarConta()">
        üîë Criar Nova Senha
      </button>

      <!-- Se√ß√£o criar conta (hidden inicialmente) -->
      <div id="criarConta" class="hidden">
        <h3 style="margin: 20px 0 10px 0">üîë Nova Senha</h3>
        <input
          type="email"
          id="email"
          placeholder="Email"
          value="gongonsilva@gmail.com"
        />
        <input
          type="password"
          id="password"
          placeholder="Nova senha (m√≠n. 6 chars)"
          value="198675gsf"
        />
        <button class="btn btn-primary" onclick="criarConta()">
          ‚úÖ Criar/Atualizar Conta
        </button>
      </div>

      <!-- Status area -->
      <div id="status"></div>

      <!-- Countdown para redirect -->
      <div id="countdown" class="countdown hidden"></div>

      <!-- Links √∫teis -->
      <div style="margin-top: 30px; text-align: center">
        <a href="/" class="btn btn-primary">üè† Voltar √† App</a>
        <a
          href="/test-firestore.html"
          class="btn"
          style="
            background: rgba(255, 255, 255, 0.2);
            color: white;
            margin-top: 10px;
          "
        >
          üî• Testar Firestore
        </a>
      </div>
    </div>

    <script>
      function showStatus(message, type = "info") {
        const statusDiv = document.getElementById("status");
        statusDiv.className = `status status-${type}`;
        statusDiv.innerHTML = message;
        statusDiv.style.display = "block";
      }

      function loginDirecto() {
        showStatus("üîÑ Fazendo login direto...", "info");

        // Criar dados do utilizador
        const userData = {
          id: 1,
          name: "Gon√ßalo Fonseca",
          email: "gongonsilva@gmail.com",
          role: "super_admin",
          active: true,
          permissions: {
            obras: { view: true, create: true, edit: true, delete: true },
            manutencoes: { view: true, create: true, edit: true, delete: true },
            piscinas: { view: true, create: true, edit: true, delete: true },
            utilizadores: {
              view: true,
              create: true,
              edit: true,
              delete: true,
            },
            relatorios: { view: true, create: true, edit: true, delete: true },
            clientes: { view: true, create: true, edit: true, delete: true },
          },
          loginTime: new Date().toISOString(),
        };

        // Salvar no localStorage
        localStorage.setItem("currentUser", JSON.stringify(userData));
        localStorage.setItem("isAuthenticated", "true");
        localStorage.setItem("bypassFirebaseAuth", "true");

        showStatus("‚úÖ Login realizado com sucesso!", "success");

        // Countdown e redirect
        let seconds = 3;
        const countdownDiv = document.getElementById("countdown");
        countdownDiv.classList.remove("hidden");

        const interval = setInterval(() => {
          countdownDiv.textContent = `Redirecionando em ${seconds}s...`;
          seconds--;

          if (seconds < 0) {
            clearInterval(interval);
            window.location.href = "/";
          }
        }, 1000);
      }

      function resetarSistema() {
        showStatus("üîÑ Resetando sistema...", "info");

        // Limpar tudo relacionado ao Firebase Auth
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (
            key &&
            (key.includes("firebase") ||
              key.includes("auth") ||
              key.includes("login"))
          ) {
            keysToRemove.push(key);
          }
        }

        keysToRemove.forEach((key) => localStorage.removeItem(key));
        sessionStorage.clear();

        // Limpar cookies Firebase
        document.cookie.split(";").forEach(function (c) {
          document.cookie = c
            .replace(/^ +/, "")
            .replace(
              /=.*/,
              "=;expires=" + new Date().toUTCString() + ";path=/",
            );
        });

        showStatus(
          "‚úÖ Sistema resetado! Tentativas de login limpas.",
          "success",
        );

        setTimeout(() => {
          showStatus(
            'üîÑ Aguarde 15 minutos antes de tentar login normal ou use "ENTRAR AGORA".',
            "info",
          );
        }, 2000);
      }

      function mostrarCriarConta() {
        const section = document.getElementById("criarConta");
        section.classList.toggle("hidden");
      }

      function criarConta() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        if (!email || !password) {
          showStatus("‚ùå Preencha email e senha", "error");
          return;
        }

        if (password.length < 6) {
          showStatus("‚ùå Senha deve ter pelo menos 6 caracteres", "error");
          return;
        }

        showStatus("üîÑ Criando/atualizando conta...", "info");

        // Salvar conta local
        const users = JSON.parse(localStorage.getItem("app-users") || "[]");

        let user = users.find((u) => u.email === email);
        if (!user) {
          user = {
            id: Date.now(),
            email: email,
            name:
              email === "gongonsilva@gmail.com"
                ? "Gon√ßalo Fonseca"
                : "Utilizador",
            role: "super_admin",
            active: true,
            createdAt: new Date().toISOString(),
          };
          users.push(user);
        }

        user.password = password;
        user.updatedAt = new Date().toISOString();

        localStorage.setItem("app-users", JSON.stringify(users));

        showStatus(
          `‚úÖ Conta atualizada! Email: ${email} | Senha: ${password}`,
          "success",
        );

        setTimeout(() => {
          showStatus(
            'üöÄ Agora pode usar "ENTRAR AGORA" ou tentar login normal.',
            "info",
          );
        }, 3000);
      }

      // Auto-check ao carregar
      window.addEventListener("load", () => {
        // Verificar se j√° est√° logado
        const isAuth = localStorage.getItem("isAuthenticated");
        if (isAuth === "true") {
          showStatus('‚ÑπÔ∏è J√° est√° logado! Clique em "Voltar √† App".', "info");
        } else {
          showStatus(
            "üì± Sistema de corre√ß√£o carregado. Escolha uma op√ß√£o acima.",
            "info",
          );
        }

        // Log para debug
        console.log("üîß Mobile Fix loaded");
        console.log("üì± User Agent:", navigator.userAgent);
        console.log(
          "üîç Current Auth:",
          localStorage.getItem("isAuthenticated"),
        );
      });
    </script>
  </body>
</html>
