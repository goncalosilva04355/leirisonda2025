<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leirisonda - Debug</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success {
        background: #d1fae5;
        color: #059669;
      }
      .error {
        background: #fee2e2;
        color: #dc2626;
      }
      .warning {
        background: #fef3c7;
        color: #d97706;
      }
      pre {
        background: #f9fafb;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç Leirisonda - Debug de Produ√ß√£o</h1>

      <div id="status"></div>

      <h2>Informa√ß√µes do Ambiente</h2>
      <div id="environment"></div>

      <h2>Testes de Conectividade</h2>
      <div id="connectivity"></div>

      <h2>Logs do Console</h2>
      <pre id="logs"></pre>

      <h2>Ac√ß√µes</h2>
      <button onclick="testApp()">Testar App Principal</button>
      <button onclick="clearCache()">Limpar Cache</button>
      <button onclick="location.reload()">Recarregar</button>
    </div>

    <script>
      let logs = [];

      function log(message, type = "info") {
        const timestamp = new Date().toISOString();
        const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
        logs.push(logEntry);
        console.log(logEntry);
        updateLogsDisplay();
      }

      function updateLogsDisplay() {
        document.getElementById("logs").textContent = logs.join("\n");
      }

      function updateStatus(message, type = "success") {
        const statusDiv = document.getElementById("status");
        statusDiv.className = `status ${type}`;
        statusDiv.textContent = message;
      }

      function testEnvironment() {
        const env = document.getElementById("environment");
        env.innerHTML = `
                <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                <p><strong>URL:</strong> ${window.location.href}</p>
                <p><strong>Protocol:</strong> ${window.location.protocol}</p>
                <p><strong>Host:</strong> ${window.location.host}</p>
                <p><strong>Viewport:</strong> ${window.innerWidth}x${window.innerHeight}</p>
                <p><strong>Local Storage:</strong> ${localStorage ? "Dispon√≠vel" : "N√£o dispon√≠vel"}</p>
                <p><strong>Session Storage:</strong> ${sessionStorage ? "Dispon√≠vel" : "N√£o dispon√≠vel"}</p>
            `;
      }

      function testConnectivity() {
        const connectivity = document.getElementById("connectivity");

        // Test if main app files exist
        const tests = [
          { name: "Index HTML", url: "/" },
          { name: "CSS Assets", url: "/assets/" },
          { name: "Manifest", url: "/manifest.json" },
          { name: "Service Worker", url: "/firebase-messaging-sw.js" },
        ];

        connectivity.innerHTML = "<p>A testar conectividade...</p>";

        Promise.all(
          tests.map((test) =>
            fetch(test.url, { method: "HEAD" })
              .then((response) => ({
                ...test,
                status: response.status,
                ok: response.ok,
              }))
              .catch((error) => ({
                ...test,
                status: "ERROR",
                ok: false,
                error: error.message,
              })),
          ),
        ).then((results) => {
          connectivity.innerHTML = results
            .map(
              (result) =>
                `<div class="status ${result.ok ? "success" : "error"}">
                        ${result.name}: ${result.ok ? "‚úÖ OK" : `‚ùå ${result.status} ${result.error || ""}`}
                    </div>`,
            )
            .join("");
        });
      }

      function testApp() {
        log("Tentando carregar aplica√ß√£o principal...");
        window.location.href = "/";
      }

      function clearCache() {
        log("A limpar cache...");
        if ("caches" in window) {
          caches.keys().then((names) => {
            names.forEach((name) => {
              caches.delete(name);
              log(`Cache eliminado: ${name}`);
            });
          });
        }
        localStorage.clear();
        sessionStorage.clear();
        log("Cache local eliminado");
        updateStatus("Cache eliminado. Recarregue a p√°gina.", "success");
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        log("Debug page carregada");
        updateStatus("Sistema de debug activo", "success");
        testEnvironment();
        testConnectivity();
      });

      // Capture console errors
      window.addEventListener("error", (event) => {
        log(
          `ERRO: ${event.message} em ${event.filename}:${event.lineno}`,
          "error",
        );
      });

      window.addEventListener("unhandledrejection", (event) => {
        log(`PROMISE REJEITADA: ${event.reason}`, "error");
      });
    </script>
  </body>
</html>
